<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8">
    <title>uhppoted-httpd</title>
    <link rel="icon"             href="images/favicon.svg">
    <link rel="mask-icon"        href="images/favicon-mask.svg" color="#000000">
    <link rel="apple-touch-icon" href="images/favicon-180x180.png">
    <link rel="manifest"         href="manifest.json">
    <link rel="stylesheet"       href="css/uhppoted.css" type="text/css">
    <link rel="stylesheet"       href="css/tabular.css"  type="text/css">
  </head>

  <body> 
    <div id="content">
      
      <!-- LOGO -->
      <div id="logo">
        <img src="images/logo.png"  />
      </div>
      
      <!-- DASHBOARD -->
      <div id="dashboard">
        {{if ne .context.User ""}}
        <div id="user">
          <div id="avatar">
          <p>{{.context.User}}</p>
          <img id="avatar" src="images/user-cog-solid.svg" />
          </div>
          <div class="menu">
            <a href="#" onclick="onSignOut(event)">Sign out</a>
          </div>
        </div>
        {{end}}
      </div>

      <!-- MAIN -->
      <div id="main">
        <table class="tabular">
          <thead>
            <tr>
              <th rowspan="2" colspan="2">Name</th>
              <th rowspan="2">Card Number</th>
              <th colspan="2">Validity</th>
              <th colspan="10">Groups</th>
            </tr>
            <tr>
              <th>From</th>
              <th>To</th>{{range .db.Groups}}
              <th>{{.Name}}</th>{{end}}
            </tr>
          </thead>
          <tbody>{{range $cid,$cardholder := .db.CardHolders}}
             <tr id="R{{$cid}}">
              <td class="name">{{$cardholder.Name}}</td>
              <td class="buttons">
                <span class="commit" id="C{{$cid}}.commit" onclick="onCommit(event)" data-enabled="false">&#9745;</span>
                <span class="rollback" id="C{{$cid}}.rollback" onclick="onRollback(event)" data-enabled="false">&#9746;</span>
              </td>
              <td>{{$cardholder.CardNumber}}</td>
              <td>{{$cardholder.From.Format "2006-01-02"}}</td>
              <td>{{$cardholder.To.Format "2006-01-02" }}</td>{{range $gid,$permission := $cardholder.Groups}}
              <td class="group"><span id="G{{$cid}}.{{$gid}}" data-original="{{$permission}}" data-value="{{$permission}}" data-changed="false" onclick="onTick(event)">{{if $permission}}Y{{else}}N{{end}}</span></td>{{end}}
             </tr>{{end}}
          </tbody>
          <tfoot>
          </tfoot>
        </table>
      </div>
    </div>
    <div class="message"><p id="message"></p></div>
  </body>

  <!-- SCRIPTS -->
 
  <script type="module" src="./javascript/uhppoted.js"></script>

  <script type="module">
    import { resetIdle, onCommit, onRollback, onTick, onSignOut } from "./javascript/uhppoted.js"

    window.onSignOut = onSignOut
    window.onCommit = onCommit
    window.onRollback = onRollback
    window.onTick = onTick

    resetIdle();
  </script>

</html>