<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8">
    <title>uhppoted-httpd</title>
    <link rel="icon"             href="images/favicon.svg">
    <link rel="mask-icon"        href="images/favicon-mask.svg" color="#000000">
    <link rel="apple-touch-icon" href="images/favicon-180x180.png">
    <link rel="manifest"         href="manifest.json">
    <link rel="stylesheet"       href="css/uhppoted.css" type="text/css">
    <link rel="stylesheet"       href="css/tabular.css"  type="text/css">
  </head>

  <body> 
    <div id="content">
      
      <!-- LOGO -->
      <div id="logo">
        <img src="images/logo.png"  />
      </div>
      
      <!-- DASHBOARD -->
      <div id="dashboard">
        <div id="stuff">
          <span class="windmill" id="windmill" ></span>
          {{if ne .context.User ""}}
          <div id="user">
            <div id="avatar">
            <p>{{.context.User}}</p>
            <img id="avatar" src="images/user-cog-solid.svg" />
            </div>
            <div class="menu">
              <a href="#" onclick="onSignOut(event)">Sign out</a>
            </div>
          </div>
          {{end}}
        </div>
      </div>

      <!-- MAIN -->
      <div id="main">
        <div>
          <div id="message" class="message">
            <div>
              <span class="warning" id="warning"></span>
              <button class="dismiss" onclick="dismiss()">&#9746;</button>
            </div>
          </div>

          <table class="tabular">
            <thead>
              <tr>
                <th rowspan="2" colspan="2">Name</th>
                <th rowspan="2">Card Number</th>
                <th colspan="2">Validity</th>
                <th colspan="10">Groups</th>
              </tr>
              <tr>
                <th>From</th>
                <th>To</th>{{range .db.Groups}}
                <th>{{.Name}}</th>{{end}}
              </tr>
            </thead>
            <tbody>{{range $cardholder := .db.CardHolders}}
               {{$cid := $cardholder.ID}}
               <tr id="{{$cid}}">
                <td class="name">{{$cardholder.Name}}</td>
                <td class="controls">
                  <span class="commit" id="{{$cid}}_commit" onclick="onCommit(event)" data-record="{{$cid}}" data-enabled="false">&#9745;</span>
                  <span class="rollback" id="{{$cid}}_rollback" onclick="onRollback(event)" data-record="{{$cid}}" data-enabled="false">&#9746;</span>
                </td>
                <td>{{$cardholder.CardNumber}}</td>
                <td>{{$cardholder.From.Format "2006-01-02"}}</td>
                <td>{{$cardholder.To.Format "2006-01-02" }}</td>{{range $gid,$member := $cardholder.Groups}}
                <td class="group"><span id="{{$member.ID}}" data-record="{{$cid}}" data-original="{{$member.Value}}" data-value="{{$member.Value}}" onclick="onTick(event)">{{if $member.Value}}Y{{else}}N{{end}}</span></td>{{end}}
               </tr>{{end}}
            </tbody>
            <tfoot>
            </tfoot>
          </table>
        </div>
      </div>
    </div>
    <div class="footer"><p>v0.0.0</p></div>
  </body>

  <!-- SCRIPTS -->
 
  <script type="module" src="./javascript/uhppoted.js"></script>
  <script type="module" src="./javascript/cardholders.js"></script>

  <script type="module">
    import { dismiss, resetIdle, onSignOut } from "./javascript/uhppoted.js"
    import { onCommit, onRollback, onTick } from "./javascript/cardholders.js"

    window.dismiss = dismiss
    window.onSignOut = onSignOut
    window.onCommit = onCommit
    window.onRollback = onRollback
    window.onTick = onTick

    resetIdle();
  </script>

</html>