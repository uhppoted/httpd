<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8">
    <title>uhppoted-httpd</title>
    <link rel="icon"             href="images/favicon.svg">
    <link rel="mask-icon"        href="images/favicon-mask.svg" color="#000000">
    <link rel="apple-touch-icon" href="images/favicon-180x180.png">
    <link rel="manifest"         href="manifest.json">
    <link rel="stylesheet"       href="css/uhppoted.css"  type="text/css">
    <link rel="stylesheet"       href="css/dashboard.css" type="text/css">
    <link rel="stylesheet"       href="css/tabular.css"   type="text/css">
  </head>

  <body> 
    <div id="content">
      
      <!-- LOGO -->
      <div id="logo">
        <img src="images/logo.png"  />
      </div>
      
      <!-- DASHBOARD -->
      <div id="dashboard">
        <div id="stuff">
          <span class="windmill" id="windmill" ></span>
          {{if ne .context.User ""}}
          <div id="user">
            <div id="avatar">
            <p>{{.context.User}}</p>
            <img id="avatar" src="images/user-cog-solid.svg" />
            </div>
            <div class="menu">
              <a href="#" onclick="onSignOut(event)">Sign out</a>
            </div>
          </div>
          {{end}}
        </div>
      </div>

      <!-- MAIN -->
      <div id="main">
        <div>
          <div id="controls">
            <div id="message" class="message">
              <div>
                <span class="warning" id="warning"></span>
                <button class="dismiss" onclick="dismiss()">&#9746;</button>
              </div>
            </div>
            <img id="refresh" src="images/sync-alt-solid.svg" onclick="onRefresh()" />
          </div>

          <div id="table">
            <table class="tabular">
              <thead>
                <tr>
                  <th class="name" rowspan="2" colspan="2">Name</th>
                  <th class="cardnumber" rowspan="2">Card Number</th>
                  <th class="validity" colspan="2">Validity</th>
                  <th class="groups" colspan="10">Groups</th>
                </tr>
                <tr>
                  <th class="from">From</th>
                  <th class="to">To</th>{{range .db.Groups}}
                  <th>{{.Name}}</th>{{else}}<th/>{{end}}
                </tr>
              </thead>
              <tbody>{{range $cardholder := .db.CardHolders}}
                 {{$cid := $cardholder.ID}}
                 <tr id="{{$cid}}">
                  <td class="name">{{$cardholder.Name}}</td>
                  <td class="controls">
                    <span class="commit" id="{{$cid}}_commit" onclick="onCommit(event)" data-record="{{$cid}}" data-enabled="false">&#9745;</span>
                    <span class="rollback" id="{{$cid}}_rollback" onclick="onRollback(event)" data-record="{{$cid}}" data-enabled="false">&#9746;</span>
                  </td>
                  
                  <td class="cardnumber">                  
                    <img class="flag" />
                    <input id="{{$cardholder.Card.ID}}" 
                           class="field"
                           type="number" 
                           value="{{$cardholder.Card.Number}}"
                           onchange="onEdited(event)" 
                           data-record="{{$cid}}"
                           data-original="{{$cardholder.Card.Number}}"
                           data-value="{{$cardholder.Card.Number}}" />
                  </td>

                  <td class="from">
                    <img class="flag" />
                    <input id="{{$cardholder.From.ID}}" 
                           class="field"
                           type="date" 
                           value="{{$cardholder.From.Format "2006-01-02"}}"
                           onchange="onEdited(event)" 
                           data-record="{{$cid}}"
                           data-original="{{$cardholder.From.Format "2006-01-02"}}"
                           data-value="{{$cardholder.From.Format "2006-01-02"}}" 
                           required />
                  </td>

                  <td class="to">
                    <img class="flag" />
                    <input id="{{$cardholder.To.ID}}" 
                           class="field"
                           type="date" 
                           value="{{$cardholder.To.Format "2006-01-02"}}"
                           onchange="onEdited(event)" 
                           data-record="{{$cid}}"
                           data-original="{{$cardholder.To.Format "2006-01-02"}}"
                           data-value="{{$cardholder.To.Format "2006-01-02"}}" 
                           required />
                  </td>

                  {{range $gid,$member := $cardholder.Groups}}
                  <td class="group">
                    <img class="flag" />
                    <input id="{{$member.ID}}"
                           class="field"
                           type="checkbox" 
                           onclick="onTick(event)"
                           data-record="{{$cid}}" 
                           data-original="{{$member.Value}}" 
                           data-value="{{$member.Value}}" 
                           {{if $member.Value}}checked{{end}}/>
                    <label for="{{$member.ID}}"><img /></label>
                  </td>{{end}}
                </tr>{{else}}<tr class="empty"><td/><td/><td/><td/><td/><td/></tr>{{end}}
              </tbody>
              <tfoot>
              </tfoot>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="footer"><p>v0.0.0</p></div>
  </body>

  <!-- SCRIPTS -->
 
  <script type="module" src="./javascript/uhppoted.js"></script>
  <script type="module" src="./javascript/cardholders.js"></script>

  <script type="module">
    import { dismiss, resetIdle, onSignOut } from "./javascript/uhppoted.js"
    import { onCommit, onRollback, onEdited, onTick, onRefresh } from "./javascript/cardholders.js"

    window.dismiss = dismiss
    window.onSignOut = onSignOut
    window.onEdited = onEdited
    window.onTick = onTick
    window.onCommit = onCommit
    window.onRollback = onRollback
    window.onRefresh = onRefresh

    resetIdle();
  </script>

</html>