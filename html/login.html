<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8">
    <title>uhppoted-httpd: Login</title>
    <link rel="icon"             href="images/favicon.svg">
    <link rel="mask-icon"        href="images/favicon-mask.svg" color="#000000">
    <link rel="apple-touch-icon" href="images/favicon-180x180.png">
    <link rel="manifest"         href="manifest.json">
    <link rel="stylesheet"       href="css/uhppoted.css" type="text/css">
  </head>

  <body> 
    <div id="content">
      
      <!-- LOGO -->
      <div id="logo">
        <img src="images/logo.png"  />
      </div>
      
      <div></div>
      <div></div>
      
      <div id="main">

        <!-- LOGIN -->
        <fieldset id="login">
          <legend>{{.Login.Legend}}</legend>
          <form action="/authorize" method="POST" onsubmit="login(event)"> 
            <div class="field">
              <input id="uid" name="uid" type="text" size="28" placeholder="{{.Login.UserID.Hint}}"  required value="admin" />
            </div>
            <div class="field">
              <input id="pwd" name="pwd" type="password" size="28" placeholder="{{.Login.Password.Hint}}" required value="uhppoted" />
              <img id="eye" src="images/eye-solid.svg" onclick="showHidePassword()"/>
            </div>
            <button action="submit">{{.Login.Ok.Label}}</button>
          </form>
          <div id="message"></div>
        </fieldset>
      </div>
    </div>
  </body>

  <!-- SCRIPTS -->
 
  <script src="./javascript/uhppoted.js"></script>

  <script>
    function showHidePassword() {
      let pwd = document.getElementById("pwd");
      let eye = document.getElementById("eye");

      if (pwd.type === 'password') {
          pwd.type = 'text';
          eye.src  = "images/eye-slash-solid.svg"
       } else {
          pwd.type = 'password';
          eye.src  = "images/eye-solid.svg"
       }
    }

    function login(event) {
      event.preventDefault();

      let credentials = { 
        uid: document.getElementById('uid').value,
        pwd: document.getElementById('pwd').value
      }

      document.getElementById('message').style.display = "none";

      postAsForm('/authenticate', credentials)
        .then(response => { 
          console.log("STATUS", response.status)
          switch (response.status) {
            case 200:
              if (response.redirected) {
                window.location = response.url
              } else {
                window.location = '/'
              }
              break;

            case 401:
              return {{.Login.Unauthorized}}
            
            default:
              return response.text()
          }
        })
        .then(msg => { 
            warning(msg);
        })
        .catch(function(err) { console.error(err) });

      // postAsJSON('/authenticate', credentials)
      //   .then(response => { 
      //         if (response.status == 200) {
      //            if (response.redirected) {
      //               window.location = response.url;
      //            } else {
      //               window.location = '/';                
      //            }
      //         } else {
      //           return response.text()
      //         }
      //     })
      //   .then(msg => { 
      //         warning(msg);
      //   })
      //   .catch(function(err) { console.error(err) });
    }

  </script>
</html>


